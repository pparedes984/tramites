/*
 * File: app/view/vwprtLoginViewController.js
 *
 * This file was generated by Sencha Architect version 4.2.4.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.5.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.5.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('Tramites.view.vwprtLoginViewController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.vwprtlogin',

    onTextfieldSpecialkey: function(field, e, eOpts) {
        if(e.getKey() == e.ENTER)
        {
            this.onButtonIngresarLClick();
        }
    },

    onButtonIngresarLClick: function(button, e, eOpts) {
        var forma = this.getView().down('#FormaLogin').getForm();

        if(forma.isValid())
        {
            forma.submit(
            {
                url: '../servidor/login/revisa',
                method: 'post',
                scope: this,
                success: function(response, opts)
                {
                    var responseData = opts.result.data;
                    VERIFICADO = responseData.verified;


                    //ROLO = JSON.parse(responseData.rolAp_apps);
                    //CARGO = responseData.cargo_apps;
                    //console.log(VERIFICADO);
                    //console.log(responseData.usuario_apps);
                    //console.log(responseData.rolAp_apps);
                    //console.log(ROL);

                    if(VERIFICADO){
                        USUARIO = responseData.usuario_apps;
                        ROL = responseData.rolAp_apps;
                        UNIDAD = responseData.unidad_apps;
                        this.getView().destroy();

                        Ext.create('Tramites.view.vwprtPrincipal', {renderTo: Ext.getBody()});


                        if(Ext.Array.contains(ROL, 1)===true){
                            Ext.getCmp('btnConsultarTramite').setVisible(true);
                        }
                        if(Ext.Array.contains(ROL, 2)===true){
                            Ext.getCmp('btnDireccionarTramite').setVisible(true);
                        }
                        if(Ext.Array.contains(ROL, 3)===true){
                            Ext.getCmp('btnAdministrarTramite').setVisible(true);
                        }
                        if(Ext.Array.contains(ROL, 4)===true){
                            Ext.getCmp('btnAdminGeneral').setVisible(true);
                        }




                        /*
                        var strDatos = Ext.getStore('DatosStore');
                        strDatos.load();

                        var strCarrera = Ext.getStore('CarreraStore');
                        strCarrera.proxy.extraParams = {
                        facultad: 0
                        };
                        strCarrera.load();

                        var strPlanificacion = Ext.getStore('PlanificacionStore');
                        strPlanificacion.proxy.extraParams = {
                        id: 0
                        };
                        strPlanificacion.load();

                        var strRegistro = Ext.getStore('RegistroStore');
                        strRegistro.proxy.extraParams = {
                        id: 0
                        };
                        strRegistro.load();

                        this.getView().destroy();
                        Ext.create('Tutorias.view.vwprtPrincipal', {renderTo: Ext.getBody()});

                        Ext.getCmp('lblUsuarioActivo').setText('Usuario: ' + USUARIO);
                        */

                    }else{
                        Ext.Msg.show({
                            title:'Error',
                            msg: 'Usted no tiene permisos para acceder',
                            buttons: Ext.Msg.OK,
                            icon: Ext.MessageBox.ERROR
                        });

                    }
                },

                failure: function(response, opts)
                {
                    Ext.Msg.show({
                        title:'Error',
                        msg: 'Usuario o clave mal ingresados',
                        buttons: Ext.Msg.OK,
                        icon: Ext.MessageBox.WARNING
                    });
                }
            });
        }
        else
        {
            Ext.Msg.alert('Error', 'Hubo un error');
        }


    }

});
